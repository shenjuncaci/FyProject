@{
    ViewBag.Title = "用户管理》表单页面";
    Layout = "~/Views/Shared/_LayoutForm.cshtml";
}
<script type="text/javascript">
    $(function () {
        BindCombobox();
        InitControl();
        //判断新增的时候。如果选择了left项目，公司、部门会自动赋值
        if (!!GetQuery('CompanyId')) {
            //获取公司名称
            AjaxJson("/CommonModule/Company/SetForm", { KeyValue: GetQuery('CompanyId') }, function (data) {
                $("#CompanyId").val(data.CompanyId);
                $("#CompanyName").val(data.FullName);
            });
            //绑定部门
            BindDepartment(); $("#DepartmentId").val(GetQuery('DepartmentId'));
        }
        SumAll();
    })
    //初始化绑定下拉框
    function BindCombobox() {
        //加载公司
        $("#CompanyName").focus(function () {
            var objId = this.id;
            comboBoxTree(objId, "150px");
            var itemtree = {
                onnodeclick: function (item) {
                    $("#CompanyId").val(item.id);
                    $('#CompanyName').val(item.text);
                    //加载部门
                    BindDepartment();
                },
                url: "@Url.Content("~/CommonModule/Company/TreeJson")"
            };
            $("#comboBoxTree" + objId).treeview(itemtree);
        })
        //工作性质
        BindDropItem("#WorkingProperty", "WorkingProperty", "==请选择==");
        //职务
        BindDropItem("#Duty", "Duty", "==请选择==");
        //学历
        BindDropItem("#Education", "Education", "==请选择==");
        //最高学位
        BindDropItem("#Degree", "Degree", "==请选择==");
        //职业资格
        BindDropItem("#Competency", "Professional", "==请选择==");

    }
    //部门下拉框
    function BindDepartment() {
        $("#DepartmentId").html("");
        $("#DepartmentId").append("<option value=''>==请选择==</option>");
        AjaxJson("/CommonModule/Department/ListJsonAll", { CompanyId: $("#CompanyId").val() }, function (DataJson) {
            $.each(DataJson, function (i) {
                $("#DepartmentId").append($("<option></option>").val(DataJson[i].departmentid).html(DataJson[i].fullname));
            });
        })
    }
    //得到一个对象实体
    function InitControl() {
        if (!!GetQuery('KeyValue')) {
            AjaxJson("/CommonModule/User/SetUserForm", { KeyValue: GetQuery('KeyValue') }, function (data) {
                SetWebControls(data);
                BindDepartment(); $("#DepartmentId").val(data.DepartmentId);
                $("#Password").val("******");
            });
        }
    }
    //保存事件
    function AcceptClick() {
        if (!CheckDataValid('#form1')) {
            return false;
        }
        Loading(true, "正在提交数据...");
        window.setTimeout(function () {
            var postData = GetWebControls("#form1");
            postData["BuildFormJson"] = JSON.stringify(GetWebControls("#CustomAttribute"));
            AjaxJson("/CommonModule/User/SubmitUserForm?KeyValue=" + GetQuery('KeyValue'), postData, function (data) {
                tipDialog(data.Message, 3, data.Code);
                top.frames[tabiframeId()].windowload();
                closeDialog();
            });
        }, 200);
    }

    function SumAll() {
        var all = 0;
        if (CheckIsNullNoTip($("#AgeOfWork").val())) {
            all = all + Number($("#AgeOfWork").val());
        }
        if (CheckIsNullNoTip($("#IsLeader").val())) {
            all = all + Number($("#IsLeader").val());
        }
        if (CheckIsNullNoTip($("#Degree").val())) {
            all = all + Number($("#Degree").val());
        }
        if (CheckIsNullNoTip($("#SkillUp").val())) {
            all = all + Number($("#SkillUp").val());
        }
        if (CheckIsNullNoTip($("#YellowBand").val())) {
            all = all + Number($("#YellowBand").val());
        }
        if (CheckIsNullNoTip($("#CourseProject").val())) {
            all = all + Number($("#CourseProject").val());
        }
        if (CheckIsNullNoTip($("#ImproveProposal").val())) {
            all = all + Number($("#ImproveProposal").val());
        }
        if (CheckIsNullNoTip($("#RationalProposal").val())) {
            all = all + Number($("#RationalProposal").val());
        }
        if (CheckIsNullNoTip($("#FiveStar1").val())) {
            all = all + Number($("#FiveStar1").val());
        }
        if (CheckIsNullNoTip($("#FiveStar2").val())) {
            all = all + Number($("#FiveStar2").val());
        }
        if (CheckIsNullNoTip($("#ExperienceYear").val())) {
            all = all + Number($("#ExperienceYear").val());
        }
        if (CheckIsNullNoTip($("#ExperienceSkill").val())) {
            all = all + Number($("#ExperienceSkill").val());
        }
        if (CheckIsNullNoTip($("#ExperiencePro").val())) {
            all = all + Number($("#ExperiencePro").val());
        }
        if (CheckIsNullNoTip($("#ExperineceCollege").val())) {
            all = all + Number($("#ExperineceCollege").val());
        }
        if (CheckIsNullNoTip($("#ExperienceWriter").val())) {
            all = all + Number($("#ExperienceWriter").val());
        }
        if (CheckIsNullNoTip($("#Honour").val())) {
            all = all + Number($("#Honour").val());
        }
        if (CheckIsNullNoTip($("#Minus1").val())) {
            all = all - Number($("#Minus1").val());
        }
        if (CheckIsNullNoTip($("#Minus2").val())) {
            all = all - Number($("#Minus2").val());
        }
        $("#SumScore").val(all);

    }
</script>
<form id="form1">
    <div id="message" style="display: none; padding: 1px; padding-bottom: 0px;"></div>
    <div class="bd" style="border-bottom: none; margin: 1px;">
        <div class="tipstitle_title settingtable bold bd todayInfoPanelTab rightPanelTitle_normal">
            <div class="tab_list_top" style="position: absolute">
                <div id="Tabbasic" class="tab_list bd actived" onclick="Tabchange('basic')">基本信息</div>
                <div id="Tabwork" class="tab_list bd " onclick="Tabchange('work')">相关评分</div>
                @*<div id="TabCustomAttribute" class="tab_list bd " onclick="Tabchange('CustomAttribute')">自定义属性</div>*@
            </div>
        </div>
    </div>
    <div class="ScrollBar" style="margin: 1px; overflow: hidden;">
        <!--基本信息-->
        <div id="basic" class="tabPanel">
            <table class="form">
                <tr>
                    <th class="formTitle">工号：</th>
                    <td class="formValue">
                        <input id="Code" onblur="FieldExist(this.id,'Base_User','UserId','工号')" type="text" class="txt required" datacol="yes" err="工号" checkexpession="NotNull" />
                    </td>
                    <th class="formTitle">姓名：</th>
                    <td class="formValue">
                        <input id="RealName" type="text" class="txt required" datacol="yes" err="真实" checkexpession="NotNull" />
                    </td>
                </tr>
                <tr>
                    <th class="formTitle">登录账户：</th>
                    <td class="formValue">
                        <input id="Account" type="text" class="txt required" datacol="yes" err="登录账户" checkexpession="NotNull" />
                    </td>
                    <th class="formTitle">登录密码：
                    </th>
                    <td class="formValue">
                        <input id="Password" type="Password" class="txt required" datacol="yes" err="登录密码" checkexpession="NotNull" />
                    </td>
                </tr>
                <tr>
                    <th class="formTitle">性别：</th>
                    <td class="formValue">
                        <select id="Gender" class="txtselect">
                            <option value="男">男</option>
                            <option value="女">女</option>
                        </select>
                    </td>
                    <th class="formTitle">出生日期：</th>
                    <td class="formValue">
                        <input id="Birthday" type="text" class="txt Wdate" onfocus="WdatePicker({maxDate:'%y-%M-%d'})" />
                    </td>
                </tr>
                <tr>
                    <th class="formTitle">联系手机：</th>
                    <td class="formValue">
                        <input id="Mobile" type="text" class="txt" datacol="yes" err="手机" checkexpession="MobileOrNull" />
                    </td>
                    <th class="formTitle">带级：</th>
                    <td class="formValue">
                        <input id="BandLevel" type="text" class="txt"/>
                    </td>
                </tr>
                <tr>
                    <th class="formTitle">电子邮箱：</th>
                    <td class="formValue">
                        <input id="Email" type="text" class="txt" />
                    </td>
                    <th class="formTitle">QQ号码：</th>
                    <td class="formValue">
                        <input id="OICQ" type="text" class="txt" />
                    </td>
                </tr>
                <tr>
                    <th class="formTitle">所在公司：</th>
                    <td class="formValue">
                        <input id="CompanyId" type="hidden" />
                        <input id="CompanyName" type="text" class="txt icontree" datacol="yes" err="所在公司" checkexpession="NotNull" />
                    </td>
                    <th class="formTitle">所在部门：</th>
                    <td class="formValue">
                        <select id="DepartmentId" class="txtselect" datacol="yes" err="所在部门" checkexpession="NotNull" >
                        </select>
                    </td>
                </tr>
                <tr>
                    <th class="formTitle"></th>
                    <td class="formValue" colspan="3">
                        <span class="item">
                            <input id="InnerUser" name="InnerUser" type="checkbox" checked="checked" style="vertical-align: middle;" />
                            <label for="InnerUser" style="vertical-align: middle;">内部员工</label>
                            &nbsp;&nbsp;
                        </span>
                        <span class="item">
                            <input id="Enabled" name="Enabled" type="checkbox" checked="checked" style="vertical-align: middle;" />
                            <label for="Enabled" style="vertical-align: middle;">有效</label>
                        </span>
                        <label style="vertical-align: middle; color: red;">注意：禁用该用户后，将不能登录。</label>
                    </td>
                </tr>
                <tr>
                    <th class="formTitle">说明：
                    </th>
                    <td class="formValue" colspan="3">
                        <textarea id="Remark" class="txtArea" rows="6"></textarea>
                    </td>
                </tr>
            </table>
        </div>
        <!--工作相关-->
        <div id="work" class="tabPanel" style="display: none;">
            <table class="form">
                <tr>
                    <th class="formTitle">司龄：</th>
                    <td class="formValue">
                        <input id="AgeOfWork" type="text" class="txt" onfocus="IsNumber(this.id)" onchange="SumAll()"/>
                    </td>
                    <th class="formTitle">班组长：</th>
                    <td class="formValue">
                        <input id="IsLeader" type="text" class="txt" onfocus="IsNumber(this.id)" onchange="SumAll()"/>
                    </td>
                </tr>
                <tr>
                    <th class="formTitle">学历：</th>
                    <td class="formValue">
                        <input id="Degree" type="text" class="txt" onfocus="IsNumber(this.id)" onchange="SumAll()"/>
                    </td>
                    <th class="formTitle">技能提升：</th>
                    <td class="formValue">
                        <input id="SkillUp" type="text" class="txt" onfocus="IsNumber(this.id)" onchange="SumAll()"/>
                    </td>
                </tr>

                <tr>
                    <th class="formTitle">精益黄带人员：</th>
                    <td class="formValue">
                        <input id="YellowBand" type="text" class="txt" onfocus="IsNumber(this.id)" onchange="SumAll()"/>
                    </td>
                    <th class="formTitle">课题项目：</th>
                    <td class="formValue">
                        <input id="CourseProject" type="text" class="txt" onfocus="IsNumber(this.id)" onchange="SumAll()"/>
                    </td>
                </tr>

                <tr>
                    <th class="formTitle">改善提案：</th>
                    <td class="formValue">
                        <input id="ImproveProposal" type="text" class="txt" onfocus="IsNumber(this.id)" onchange="SumAll()"/>
                    </td>
                    <th class="formTitle">合理化建议：</th>
                    <td class="formValue">
                        <input id="RationalProposal" type="text" class="txt" onfocus="IsNumber(this.id)" onchange="SumAll()"/>
                    </td>
                </tr>
                <tr>
                    <th class="formTitle">五星班组-五大员：</th>
                    <td class="formValue">
                        <input id="FiveStar1" type="text" class="txt" onfocus="IsNumber(this.id)" onchange="SumAll()"/>
                    </td>
                    <th class="formTitle">五星班组-星级班组：</th>
                    <td class="formValue">
                        <input id="FiveStar2" type="text" class="txt" onfocus="IsNumber(this.id)" onchange="SumAll()"/>
                    </td>
                </tr>
                <tr>
                    <th class="formTitle">经验传承-师带徒：</th>
                    <td class="formValue">
                        <input id="ExperienceYear" type="text" class="txt" onfocus="IsNumber(this.id)" onchange="SumAll()"/>
                    </td>
                    <th class="formTitle">经验传承-技能教练：</th>
                    <td class="formValue">
                        <input id="ExperienceSkill" type="text" class="txt" onfocus="IsNumber(this.id)" onchange="SumAll()"/>
                    </td>
                </tr>
                <tr>
                    <th class="formTitle">经验传承-专业传承：</th>
                    <td class="formValue">
                        <input id="ExperiencePro" type="text" class="txt" onfocus="IsNumber(this.id)" onchange="SumAll()"/>
                    </td>
                    <th class="formTitle">文化贡献-社团建设：</th>
                    <td class="formValue">
                        <input id="ExperineceCollege" type="text" class="txt" onfocus="IsNumber(this.id)" onchange="SumAll()"/>
                    </td>
                </tr>
                <tr>
                    <th class="formTitle">文化贡献-通讯稿：</th>
                    <td class="formValue">
                        <input id="ExperienceWriter" type="text" class="txt" onfocus="IsNumber(this.id)" onchange="SumAll()"/>
                    </td>
                    <th class="formTitle">荣誉：</th>
                    <td class="formValue">
                        <input id="Honour" type="text" class="txt" onfocus="IsNumber(this.id)" onchange="SumAll()"/>
                    </td>
                </tr>
                <tr>
                    <th class="formTitle">违纪扣分：</th>
                    <td class="formValue">
                        <input id="Minus1" type="text" class="txt" onfocus="IsNumber(this.id)" onchange="SumAll()"/>
                    </td>
                    <th class="formTitle">安全扣分：</th>
                    <td class="formValue">
                        <input id="Minus2" type="text" class="txt" onfocus="IsNumber(this.id)" onchange="SumAll()" />
                    </td>
                </tr>
                <tr>
                    <th class="formTitle">总分：</th>
                    <td class="formValue">
                        <input readonly id="SumScore" type="text" class="txt" onfocus="IsNumber(this.id)" />
                    </td>
                    <th class="formTitle"></th>
                    <td class="formValue">
                        
                    </td>
                </tr>



            </table>
        </div>
        <!--自定义属性-->
        <div id="CustomAttribute" class="tabPanel" style="display: none;">
            @Html.Raw(@LeaRun.WebApp.BaseCommon.CreateBuildForm(2))
        </div>
    </div>

</form>
