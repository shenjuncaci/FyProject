@{
    ViewBag.Title = "技能列表";
    Layout = "~/Views/Shared/_LayoutIndex.cshtml";
}
<script>

    //注意：parent 是 JS 自带的全局对象，可用于操作父页面
    var index = parent.layer.getFrameIndex(window.name); //获取窗口索引
    //parent.layer.iframeAuto(index);

    $(function () {
        $("#keywords").focus();

        GetGrid();
        //绑定键盘按下事件
        $(document).keypress(function (e) {
            // 回车键事件
            if (e.which == 13) {
                $("#keywords").focus();
                $("#keywords").select();
                $("#btnSearch").click();
            }
        });
    });
    //搜索
    function btn_Search() {
        var ProjectName = $("#ProjectName").val();
        var keywords = " and (f.projectname like '%" + ProjectName + "%' or f.FileYmBatch like '%" + ProjectName + "%')";
        $("#gridTable").jqGrid('setGridParam', {
            url: encodeURI("@Url.Content("~/VPModule/RiskDownFollow/GridFmeaListJson")?keywords=" + keywords)
        }).trigger('reloadGrid');
    }
    //显示技能列表
    function GetGrid() {
        //var index = GetQuery('index');
        $("#gridTable").jqGrid({
            url: "@Url.Content("~/VPModule/RiskDownFollow/GridFmeaListJson")",
            datatype: "json",
            height: 200,
            autowidth: true,
            colModel: [
                { label: '项目编号', name: "projectname", width: 120, sortable: false },
                { label: '系统版本', name: "fileymbatch", width: 150, sortable: false, hidden: true },
                { label: '客户名称', name: "dwname", width: 150, sortable: false },
                { label: '部件编号', name: "partnumber", width: 150, sortable: false },
                { label: '部件名称', name: "partname", width: 150, sortable: false },
                { label: '型号', name: "partmodel", width: 80, sortable: false },
                { label: '版本号', name: "versioncode", width: 30, sortable: false },


            ],
            viewrecords: true,
            rowNum: 8,
            rowList: [30, 50, 100, 500, 1000],
            pager: "#gridPager",
            sortname: 'fileymbatch',
            sortorder: 'desc',
            rownumbers: true,
            shrinkToFit: false,
            gridview: true,
            multiselect: false,
            //双击事件
            //ondblClickRow: function (RowIndx) {
            //    var rowData = $(this).jqGrid('getRowData', RowIndx);
            //    //var $parentobj = top.$.dialog;
            //    //if (!$parentobj.IsExistItem(index, rowData.SkillID)) {
            //    //    $parentobj.$("#SkillID➩" + index).val(rowData.SkillID);
            //    //    $parentobj.$("#SkillName➩" + index).val(rowData.SkillName);

            //    //    index++;

            //    // closeDialog();
            //    //} else {
            //    //    top.TipMsg("技能已存在,不能重复添加", 4000, "error");
            //    //}
            //    var ResultArr = new Array();
            //    ResultArr[0] = rowData.skillid;
            //    ResultArr[1] = rowData.skillname;
            //    ResultArr[2] = rowData.skilldescripe;

            //    window.returnValue = ResultArr;
            //    window.close();
            //}
        });
    }

    //多选，一次传多个技能回去
    function btn_Confirm()
    {
        var Result = new Array();
        var projectname = GetJqGridRowValue("#gridTable", "projectname");
        var fileymbatch = GetJqGridRowValue("#gridTable", "fileymbatch");
        var versioncode = GetJqGridRowValue("#gridTable", "versioncode");
        //var SkillDescripe = GetJqGridRowValue("#gridTable", "skilldescripe");
        //var SkillIDArr = SkillId.split(",");
        //var SkillNameArr = SkillName.split(",");

        //for (var i = 0; i < SkillIDArr.length; i++)
        //{

        //    var TempObject = {};
        //    TempObject["SkillID"] = SkillIDArr[i];
        //    TempObject["SkillName"] = SkillNameArr[i];
        //    Result.push(TempObject);

        //}


        Result[0] = projectname;
        Result[1] = fileymbatch;
        Result[2] = versioncode;


        if (Result.length==0)
        {
            alert("请至少选择一个FMEA");
            return false;
        }

        parent.SelectProject(Result);
        parent.layer.close(index);


    }


</script>
<div class="border" style="margin: 1px; border-bottom: none; margin-bottom: 0px;">
    <div class="QueryArea">
        <table border="0" class="form-find" style="height: 45px;">
            <tr>
                <th>
                    模糊搜索：
                </th>
                <td>
                    <input id="ProjectName" type="text" class="txt" style="width: 50px" />
                </td>

                <td>
                    <input id="btnSearch" type="button" class="btnSearch" value="搜 索" onclick="btn_Search()" />
                </td>
                <td>
                    <input id="btnSearch" type="button" class="btnSearch" value="确 认" onclick="btn_Confirm()" />
                </td>
            </tr>
        </table>
    </div>
    <div class="line"></div>
    <table id="gridTable"></table>
    <div id="gridPager"></div>
    <style>
        .ui-widget-content {
            border-left: none;
        }

        .ui-th-column, .ui-jqgrid .ui-jqgrid-htable th.ui-th-column {
            background: none;
        }
    </style>
</div>
